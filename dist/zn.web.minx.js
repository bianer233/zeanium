!function(a){var b=(a.Class({events:["init","start","stop","cancle","goNext","goPre"],properties:{pre:null,next:null,delay:null,action:null,args:[],context:this,taskList:null,status:{value:"",get:function(){return this._status}}},methods:{init:function(a){this.sets(a),this.fire("init",this)},start:function(){"started"!=this._status&&(this._action?(this._action.apply(this._context,this._args),this._status="started"):this.goNext(),this.fire("start",this))},stop:function(){this._status="stoped",this.fire("stop",this)},cancle:function(){this._status="cancle",this.fire("cancle",this)},goNext:function(){this._next&&this._next.start(),this.fire("goNext",this)},goPre:function(){this._pre&&this._pre.start(),this.fire("goPre",this)}}}),a.Class({properties:{url:"",data:{set:function(a){this._data=a},get:function(){return a.is(this._data,"object")?JSON.stringify(this._data):this._data}},method:"GET",asyns:!0,username:null,password:null,headers:{get:function(){return a.overwrite({"X-Requested-With":"XMLHttpRequest","Content-type":"application/json"},this._headers)},set:function(a){this._headers=a}},timeout:{get:function(){return this._timeout||2e4},set:function(a){this._timeout=a}}},events:["before","after","success","error","complete","timeout"],methods:{init:function(a){this.sets(a),this._isRunning=!1},__initXMLHttpRequest:function(){if(this._XMLHttpRequest)return this._XMLHttpRequest;if(!window.ActiveXObject)return this._XMLHttpRequest=new XMLHttpRequest,this._XMLHttpRequest;for(var a="MSXML2.XMLHTTP",b=["Microsoft.XMLHTTP",a,a+".3.0",a+".4.0",a+".5.0",a+".6.0"],c=b.length-1;c>-1;c--)try{return this._XMLHttpRequest=new ActiveXObject(b[c]),this._XMLHttpRequest}catch(d){continue}},__onComplete:function(a,b){clearTimeout(this._timeoutID),a.abort(),this._isRunning=!1,this.fire("complete",a,b),this.fire("after",a,b),this.offs()},__initRequestHeader:function(a,b){for(var c in b)a.setRequestHeader(c,b[c])},resetEvents:function(){this.offs()},send:function(b){if(this._isRunning)return!1;this.sets(b);var c=this.__initXMLHttpRequest(),d=this,e=a.async.defer();if(this._isRunning=!0,this.timeout&&(this._timeoutID=setTimeout(function(){d._isRunning&&(d.fire("timeout",d),d.__onComplete(c,"timeout"))},this.timeout)),this.fire("before",this)===!1||!this.url)return this.__onComplete(c),e.promise;var f=this.url,g=this.data,h=this._method.toUpperCase();return"GET"===h&&(g&&(f=f+"?"+g),g=null),c.readyState<2,c.open(h,f,this.asyns),c.onreadystatechange=function(a){var b=a.currentTarget;if(4==b.readyState){var c=b.status,d=b.responseText,f=b.getResponseHeader("Content-Type");if(c>=200&&300>c){try{d=f&&f.indexOf("application/json")>=0?JSON.parse(d):d}catch(g){d=d}this.fire("success",d),e.resolve(d,b)}else this.fire("error",b),e.reject(b,d);return this.__onComplete(b,d),d}}.bind(this),this.__initRequestHeader(c,this.headers),c.send(g),this.asyns||this.__onComplete(c),e.promise},abort:function(){this._XMLHttpRequest&&this._XMLHttpRequest.abort()}}})),c=a.Class({"static":!0,properties:{max:3,count:{get:function(){return this._data.length}}},methods:{init:function(){this._data=[]},getInstance:function(){for(var a=0,c=this._data.length;c>a;a++)if(!this._data[a]._isRunning)return this._data[a].resetEvents(),this._data[a];return function(a){var c=new b;return a._data.push(c),c}(this)}}});a.http=a.Class({"static":!0,properties:{timeout:1e3},methods:{request:function(b,d){var e=c.getInstance();return a.each(b,function(a,b){"function"==typeof a&&e.on(b,a,this)},this),d&&d(e),e.send(b)},get:function(a){return a.method="GET",this.request(a)},post:function(a){return a.method="POST",this.request(a)},put:function(a){return a.method="PUT",this.request(a)},"delete":function(a){return a.method="DELETE",this.request(a)}}})}(zn),function(a){var b=a.Class({events:["init","validate","before","success","error","complete","after"],properties:{url:null,data:null,method:"POST",headers:null},methods:{init:function(a,b,c,d){this.sets({url:a,data:b,method:c,headers:d}),this.fire("init",this.gets())},validateArgv:function(a,b,c,d){var e=a||this._url||"",f=b||this._data||{},g=c||this._method||"POST",h=d||this._headers||{},i={url:e,data:f,method:g,headers:h};return i},exec:function(a,b,c,d){var e=this.validateArgv(a,b,c,d),f=Store.fire("before",e);return f===!1?!1:(f=this.fire("before",e),f===!1?!1:e)},__onComplete:function(a){var b=Store.fire("after",a);return b===!1?!1:(b=this.fire("complete",a),b===!1?!1:void 0)},__onSuccess:function(a,b){var c=Store.fire("success",a,b);return c===!1?!1:(c=this.fire("success",a,b),c===!1?!1:void 0)},__onError:function(a){var b=Store.fire("success",a);return b===!1?!1:(b=this.fire("success",a),b===!1?!1:void 0)},refresh:function(a,b,c,d){return this.exec(a,b,c,d)},clone:function(b){var c=this._data;return c="object"==typeof c?a.extend(JSON.parse(JSON.stringify(c)),b):b,new this.constructor(this._url,c,this._method,this._headers)},extend:function(b){return this._data=a.extend(this._data,b),this},overwrite:function(b){return this._data=a.overwrite(this._data,b),this}}}),c=a.Class(b,{methods:{init:function(a,b,c,d){this.sets({url:a,data:b,method:c,headers:d}),this.fire("init",this.gets())},exec:function(b,c,d,e){var f=this.validateArgv(b,c,d,e),g=Store.fire("before",f);return g===!1?!1:(g=this.fire("before",f),g===!1?!1:f===!1?!1:a.http[f.method.toLowerCase()]({url:Store.fixURL(f.url),data:f.data,headers:f.headers,success:function(a,b,c){this.__onSuccess(b,c)}.bind(this),error:function(a,b){this.__onError(b)}.bind(this),complete:function(a,b){this.__onComplete(b)}.bind(this)}))}}}),d=a.Class(b,{methods:{init:function(a,b,c,d){this.sets({url:a,data:b,method:c,headers:d}),this.fire("init",this.gets())},exec:function(b,c,d,e){var f=this.validateArgv(b,c,d,e),g=Store.fire("before",f);if(g===!1)return!1;if(g=this.fire("before",f),g===!1)return!1;if(f===!1)return!1;var h=f.url,i=f.method,j=f.data,k=f.headers,l=this,m={method:i.toUpperCase()};switch(i.toUpperCase()){case"POST":var n=new FormData;for(var o in j)n.append(o,j[o]);m.body=n,m.headers=a.overwrite(k,{Accept:"multipart/form-data","Content-Type":"multipart/form-data; charset=UTF-8"});break;case"GET":var p=[];a.each(j,function(a,b){p.push(b+"="+a)}),h+="?"+p.join("&");break;case"JSON":m.body=JSON.stringify(j),m.method="POST",m.headers=a.overwrite(k,{Accept:"multipart/form-data","Content-Type":"multipart/form-data; charset=UTF-8"})}return new Promise(function(a,b){fetch(Store.fixURL(h),m).then(function(a){return a.json()}).then(function(b){l.__onSuccess(b),l.__onComplete(b),a(b)}).catch(function(a){l.__onError(a),l.__onComplete(a),b(a)})})}}}),e=a.Class({events:["init","before","after"],properties:{data:null,argv:{set:function(a){this._argv=a},get:function(){return this._argv||{}}}},methods:{init:function(a,b){this.reset(a,b),this.fire("init",this)},reset:function(a,b){return a&&(this._data=a),b&&(this._argv=b),this._argv&&this._argv.autoLoad&&this.exec(),this},refresh:function(){return this.exec(),this},exec:function(){var a=this._data,b=this;if(!a)return!1;if((this._argv.onExec&&this._argv.onExec(a))===!1)return!1;var c=this.fire("before",a);return c===!1?!1:a.__id__?void a.on("success",function(a,c){b._argv.onSuccess&&b._argv.onSuccess(c)}).on("error",function(a,c){b._argv.onError&&b._argv.onError(c)}).on("complete",function(a,c){b._argv.onComplete&&b._argv.onComplete(c)}).exec():new Promise(function(c,d){if(a){if(Store.fire("success",a)===!1)return!1;b._argv.onSuccess&&b._argv.onSuccess(a),b._argv.onComplete&&b._argv.onComplete(a),c(a)}else{if(Store.fire("error",a)===!1)return!1;b._argv.onError&&b._argv.onError(a),b._argv.onComplete&&b._argv.onComplete(a),d(a)}})}}}),f=a.Class({events:["before","success","error","complete","after"],properties:{host:window.location.origin,engine:{set:function(a){this._engine=a},get:function(){return"Fetcher"==this._engine?d:c}},headers:{}},methods:{request:function(a,b,e,f){var g=null;return new(g="Fetcher"==this._engine?d:c)(a,b,e,f)},post:function(a,b,c){return this.request(a,b,"POST",c)},"delete":function(a,b,c){return this.request(a,b,"DELETE",c)},put:function(a,b,c){return this.request(a,b,"PUT",c)},get:function(b,c,d){var e=[];return a.each(c,function(b,c){e.push(c+"="+(a.is(b,"object")?JSON.stringify(b):b))}),this.request(b,e.join("&"),"GET",d)},setHost:function(a){this._host=a},getHost:function(){return this._host},fixURL:function(a){return a?(a&&-1===a.indexOf("http://")&&(a=this._host+a),a):""},dataSource:function(a,b){return new e(a,b)}}});a.store=a.GLOBAL.Store=new f}(zn),function(a){a.cookie=a.Class({"static":!0,methods:{setItem:function(a,b,c){var d=a+"="+encodeURIComponent(b);c&&(d+="; expires="+new Date(+new Date+36e5*c).toGMTString()),document.cookie=d},getItem:function(a){var b=new RegExp("(?:; )?"+a+"=([^;]*);?");return b.test(document.cookie)?decodeURIComponent(RegExp.$1):null},removeItem:function(a){this.setItem(a,null,-9999)},clear:function(){document.cookie=null}}})}(zn),function(a){var b=document.createElement("div"),c=b.style,d=/width|height|top|right|bottom|left|size|margin|padding/i,e=/[c-x%]/,f="px",g=/(?:^|-)([a-z])/g,h=/([A-Z])/g,i={lineHeight:!0,zIndex:!0,zoom:!0},j={"float":"cssFloat"};a.style=a.Class({"static":!0,methods:{each:function(a,b,c){if(a&&b){var d=a.length;if(d>=0)for(var e=0;d>e;e++)b.call(c,a[e],e);else for(var f in a)a.hasOwnProperty(f)&&b.call(c,a[f],f)}},getCssText:function(a){var b=[""];return this.each(a,function(a,c){b.push(this.getStyleProperty(c,!0)+":"+this.getStyleValue(c,a))},this),b.join(";")},getStyleValue:function(a,b){var c=this.getStyleProperty(a),g=b;return d.test(c)&&(e.test(b)||i[c]||(g+=f)),g},getStyleProperty:function(a,b){var d=this.lowerCamelCase(a);return d in c?b&&(d=this.deCamelCase(a)):d=b?env.prefix()[1]+a:env.prefix()[0]+this.upperCamelCase(a),j[a]||d},lowerCamelCase:function(a){var b=this.upperCamelCase(a);return b.charAt(0).toLowerCase()+b.substring(1)},upperCamelCase:function(a){return a.replace(g,function(a,b){return b.toUpperCase()})},deCamelCase:function(a){return a.replace(h,function(a,b){return"-"+b.toLowerCase()})},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)}}}),a.dom=a.Class({"static":!0,methods:{hasClass:function(a,b){return a.classList.contains(b)},addClass:function(a){var b=a.classList;return arguments.shift(),b.add.apply(b,arguments)},removeClass:function(a){var b=a.classList;return arguments.shift(),b.remove.apply(b,arguments)},toggleClass:function(a,b){return a.classList.toggle(b)},setStyle:function(b,c,d){var e=a.style.getStyleProperty(c);b.style[e]=a.style.getStyleValue(c,d)},getStyle:function(b,c,d){var e=b,f=a.style.getStyleProperty(c),g=d?b.style:window.getComputedStyle?getComputedStyle(e,null):e.currentStyle;return g[f]||""},removeStyle:function(b,c){var d=a.style.getStyleProperty(c,!0);b.style.removeProperty(d)},hasStyle:function(a,b){var c=a.style.cssText;return c.indexOf(b+":")>-1},setStyles:function(b,c){b.style.cssText+=a.style.getCssText(c)},getPosition:function(a){var b=a,c=0,d=0,e=0,f=0;if(b.getBoundingClientRect){var g=b.getBoundingClientRect();c=g.left+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)-document.documentElement.clientLeft,d=g.top+Math.max(document.documentElement.scrollTop,document.body.scrollTop)-document.documentElement.clientTop,e=g.width,f=g.height}else{for(;b!=document.body&&b;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;e=b.offsetWidth,f=b.offsetHeight}return{x:c,y:d,width:e,height:f}},on:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):element.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},off:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null}}})}(zn);